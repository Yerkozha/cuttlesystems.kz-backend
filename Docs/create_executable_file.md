### Инструкция по созданию исполняемого файла  (*Win, Linux*) с помощью утилиты *PyInstaller*



##### Создание *exe* файла с помощью *PyInstaller*

*PyInstaller* собирает в один пакет *Python*-приложение и все необходимые ему библиотеки следующим образом:

- считывает файл скрипта

- анализирует код для выявления всех зависимостей, необходимых для работы

- создает файл *spec*, который содержит название скрипта, библиотеки-зависимости, любые файлы, включая те параметры, которые были переданы в команду *PyInstaller*

- собирает копии всех библиотек и файлов вместе с активным интерпретатором *Python*

- создает папку *BUILD* в папке со скриптом и записывает логи вместе с рабочими файлами в *BUILD*

- создает папку *DIST* в папке со скриптом, если она еще не существует

- записывает все необходимые файлы вместе со скриптом или в одну папку, или в один исполняемый файл

  

1. для установки утилиты *PyInstaller* следует находясь в виртуальном окружении выполнить команду:
   `pip install pyinstaller`

2. проверить установленную версию *PyInstaller* можно командой:

   `pyinstaller --version`

3.  непосредственно для создания исполняемого файла в командной строке выполняется команда:

   `pyinstaller --onefile start_constructor.py`

   <u>Примечание:</u>

    - если используется параметр `--onedir` или `-D` при генерации исполняемого файла, тогда всё будет помещено в одну папку (это поведение по умолчанию);
    - если же использовать параметр `--onefile` или `-F`, то всё окажется в одном исполняемом файле

   *Python* создает каталог распространения, который содержит основной исполняемый файл, а также все динамические библиотеки.

   ​	После завершения установки в рабочей директории появятся две папки:

   **BUILD** и **DIST**, а также новый файл с расширением *.spec*

   Название *spec*-файла будет таким же, как и наименование файла скрипта.

   

   ###### Файл *spec*

   ​	Файл *spec* — это первый файл, который *PyInstaller* создает, чтобы закодировать содержимое скрипта *Python* вместе с передаваемыми при запуске параметрами.

   *PyInstaller* считывает содержимое файла для создания исполняемого файла, определяя всё, что может понадобиться для его запуска.

   Файл с расширением *.spec* по умолчанию сохраняется  в текущей директории.

   

4. Дополнительные импорты с помощью *Hidden Imports*

​	Исполняемому файлу требуются все импорты, которые нужны *python*-скрипту. Иногда *PyInstaller* может пропустить динамические импорты или импорты второго уровня, возвращая ошибку `ImportError: No module named`

​	Для разрешения этой ошибки необходимо передать название недостающей библиотеки в *hidden-import*

<u>Например</u>, чтобы добавить библиотеку *'os'*, в командной строке следует написать команду:

```
pyinstaller --onefile --hidden-import "os" simple1.py
```



В нашем случае для правильной сборки исполняемого файла *start_constructor* также потребовалось использовать опцию  *'hidden-import'*

Алгоритм:

- в результате выполнения команды

  `pyinstaller --onefile start_constructor.py`

  создаётся файл *start_constructor.spec*

- содержимое папок **BUILD** и **DIST** необходимо удалить

- отредактировать файл *start_constructor.spec*, добавив строки

      pathex=[
      '.',
      ],
      binaries=[],
      datas=[],
      hiddenimports=['desktop_constructor_app'],

  где '.' определяет рабочую директорию для сборки исполняемого файла (*'tg_bot_constructor'*),

  ​	а *'desktop_constructor_app'* - импортируемый через опцию *hidden-import* модуль

- после редактирования содержимого файла *start_constructor.spec* выполняется новая сборка исполняемого файла командой:

   `pyinstaller start_constructor.spec`

  ​	<u>Примечание:</u> файл *start_constructor.spec* можно также получить не выполняя сборку с помощью команды `pyi-makespec start_constructor.spec`, в результате выполнения которой создается *spec*-файл по умолчанию, содержащий все параметры, которые можно указать в командной строке; файл *start_constructor.spec* создается в текущей директории

  





 

1. 
2. 
3. 
4. 
5. 